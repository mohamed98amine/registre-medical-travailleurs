<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üß™ Test Demande d'Affiliation</title>
    <style>
        body { 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
            margin: 0; 
            padding: 20px; 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        .container { 
            max-width: 800px; 
            margin: 0 auto; 
            background: white; 
            border-radius: 20px; 
            padding: 30px; 
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
        }
        .header {
            text-align: center;
            margin-bottom: 40px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            border-radius: 15px;
            margin: -30px -30px 40px -30px;
        }
        .card { 
            background: white; 
            border-radius: 12px; 
            padding: 25px; 
            margin: 20px 0; 
            box-shadow: 0 4px 6px rgba(0,0,0,0.07);
            border: 1px solid #e5e7eb;
        }
        button { 
            padding: 12px 24px; 
            border: none; 
            border-radius: 8px; 
            cursor: pointer; 
            font-size: 14px; 
            font-weight: 500;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            margin: 10px 5px;
        }
        button:hover { transform: translateY(-1px); box-shadow: 0 4px 8px rgba(0,0,0,0.1); }
        .btn-primary { background: linear-gradient(135deg, #3b82f6, #1d4ed8); color: white; }
        .btn-success { background: linear-gradient(135deg, #10b981, #059669); color: white; }
        .btn-warning { background: linear-gradient(135deg, #f59e0b, #d97706); color: white; }
        .result { 
            margin: 15px 0; 
            padding: 15px; 
            border-radius: 8px; 
            font-family: 'Fira Code', monospace; 
            font-size: 13px; 
            line-height: 1.5;
            white-space: pre-wrap;
            border-left: 4px solid;
        }
        .result.success { background: #ecfdf5; color: #166534; border-color: #10b981; }
        .result.error { background: #fef2f2; color: #991b1b; border-color: #ef4444; }
        .result.info { background: #eff6ff; color: #1e40af; border-color: #3b82f6; }
        input, select, textarea { 
            padding: 10px 15px; 
            border: 2px solid #e5e7eb; 
            border-radius: 8px; 
            font-size: 14px; 
            width: 100%;
            margin: 5px 0;
            box-sizing: border-box;
        }
        input:focus, select:focus, textarea:focus { 
            outline: none; 
            border-color: #3b82f6; 
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }
        .form-group { margin: 15px 0; }
        label { font-weight: 600; color: #374151; font-size: 14px; display: block; margin-bottom: 5px; }
        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
        #results { max-height: 400px; overflow-y: auto; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üß™ Test Demande d'Affiliation</h1>
            <p>Test complet du syst√®me de demandes d'affiliation</p>
        </div>

        <!-- Configuration -->
        <div class="card">
            <h2>‚öôÔ∏è Configuration</h2>
            <div class="form-group">
                <label>Backend URL:</label>
                <input type="text" id="backendUrl" value="http://localhost:8080/api" />
            </div>
            <div class="grid">
                <div class="form-group">
                    <label>Email Employeur:</label>
                    <input type="text" id="emailEmployeur" value="kr98@gmail.com" />
                </div>
                <div class="form-group">
                    <label>Mot de passe:</label>
                    <input type="password" id="password" value="password123" />
                </div>
            </div>
            <button class="btn-primary" onclick="authenticateEmployeur()">üîê Connexion Employeur</button>
        </div>

        <!-- Test cr√©ation demande -->
        <div class="card">
            <h2>üìù Test Cr√©ation Demande</h2>
            <div class="grid">
                <div class="form-group">
                    <label>Raison Sociale:</label>
                    <input type="text" id="raisonSociale" value="SARL Test Entreprise" />
                </div>
                <div class="form-group">
                    <label>Num√©ro RCCM:</label>
                    <input type="text" id="numeroRccm" value="BF-OUA-2024-TEST-001" />
                </div>
                <div class="form-group">
                    <label>Secteur d'Activit√©:</label>
                    <select id="secteurActivite">
                        <option value="Industrie Manufacturi√®re">Industrie Manufacturi√®re</option>
                        <option value="BTP et Construction">BTP et Construction</option>
                        <option value="Commerce et Distribution">Commerce et Distribution</option>
                        <option value="Services aux Entreprises">Services aux Entreprises</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Effectif:</label>
                    <input type="number" id="effectif" value="25" min="1" />
                </div>
            </div>
            <div class="form-group">
                <label>Adresse:</label>
                <textarea id="adresse" rows="2">123 Avenue de la Paix, Ouagadougou, Burkina Faso</textarea>
            </div>
            <div class="grid">
                <div class="form-group">
                    <label>Repr√©sentant L√©gal:</label>
                    <input type="text" id="representantLegal" value="Jean Dupont" />
                </div>
                <div class="form-group">
                    <label>Contact DRH:</label>
                    <input type="text" id="contactDrh" value="Marie Martin" />
                </div>
                <div class="form-group">
                    <label>Email:</label>
                    <input type="email" id="email" value="contact@test-entreprise.bf" />
                </div>
                <div class="form-group">
                    <label>T√©l√©phone:</label>
                    <input type="tel" id="telephone" value="+226 25 30 40 50" />
                </div>
            </div>
            <div class="form-group">
                <label>Chiffre d'Affaires Annuel (FCFA):</label>
                <input type="number" id="chiffreAffaire" value="50000000" />
            </div>
            <div class="form-group">
                <label>Commentaires:</label>
                <textarea id="commentaires" rows="2">Demande de test pour validation du syst√®me</textarea>
            </div>
            <button class="btn-success" onclick="createDemande()">‚ú® Cr√©er la Demande</button>
        </div>

        <!-- Test r√©cup√©ration demandes -->
        <div class="card">
            <h2>üìã Test R√©cup√©ration Demandes</h2>
            <button class="btn-primary" onclick="getMyDemandes()">üìä Mes Demandes</button>
            <button class="btn-warning" onclick="testDirecteurLogin()">üëî Test Directeur</button>
        </div>

        <!-- R√©sultats -->
        <div class="card">
            <h2>üìã R√©sultats</h2>
            <div id="results"></div>
        </div>
    </div>

    <script>
        let token = '';
        const API_BASE = () => document.getElementById('backendUrl').value;

        function addResult(message, type = 'info') {
            const results = document.getElementById('results');
            const div = document.createElement('div');
            div.className = `result ${type}`;
            div.textContent = new Date().toLocaleTimeString() + ' - ' + message;
            results.appendChild(div);
            results.scrollTop = results.scrollHeight;
        }

        async function authenticateEmployeur() {
            const email = document.getElementById('emailEmployeur').value;
            const password = document.getElementById('password').value;

            addResult('üîÑ Connexion employeur...', 'info');

            try {
                const response = await fetch(`${API_BASE()}/auth/login`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ email, password })
                });

                if (response.ok) {
                    const data = await response.json();
                    token = data.token;
                    addResult('‚úÖ Employeur connect√© - Token obtenu', 'success');
                } else {
                    const errorText = await response.text();
                    addResult(`‚ùå Erreur connexion: ${response.status} - ${errorText}`, 'error');
                }
            } catch (error) {
                addResult(`‚ùå Erreur r√©seau: ${error.message}`, 'error');
            }
        }

        async function createDemande() {
            if (!token) {
                addResult('‚ùå Connectez-vous d\'abord', 'error');
                return;
            }

            const demandeData = {
                raisonSociale: document.getElementById('raisonSociale').value,
                numeroRccm: document.getElementById('numeroRccm').value,
                secteurActivite: document.getElementById('secteurActivite').value,
                effectif: parseInt(document.getElementById('effectif').value),
                adresse: document.getElementById('adresse').value,
                representantLegal: document.getElementById('representantLegal').value,
                contactDrh: document.getElementById('contactDrh').value,
                email: document.getElementById('email').value,
                telephone: document.getElementById('telephone').value,
                chiffreAffaireAnnuel: parseFloat(document.getElementById('chiffreAffaire').value),
                commentaires: document.getElementById('commentaires').value
            };

            addResult('üîÑ Cr√©ation de la demande...', 'info');
            addResult(`üì§ Donn√©es: ${JSON.stringify(demandeData, null, 2)}`, 'info');

            try {
                const response = await fetch(`${API_BASE()}/demandes-affiliation`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    },
                    body: JSON.stringify(demandeData)
                });

                if (response.ok) {
                    const result = await response.json();
                    addResult('‚úÖ Demande cr√©√©e avec succ√®s !', 'success');
                    addResult(`üìã R√©ponse: ${JSON.stringify(result, null, 2)}`, 'success');
                } else {
                    const errorText = await response.text();
                    addResult(`‚ùå Erreur cr√©ation: ${response.status} - ${errorText}`, 'error');
                }
            } catch (error) {
                addResult(`‚ùå Erreur r√©seau: ${error.message}`, 'error');
            }
        }

        async function getMyDemandes() {
            if (!token) {
                addResult('‚ùå Connectez-vous d\'abord', 'error');
                return;
            }

            addResult('üîÑ R√©cup√©ration des demandes...', 'info');

            try {
                const response = await fetch(`${API_BASE()}/demandes-affiliation/my`, {
                    headers: { 'Authorization': `Bearer ${token}` }
                });

                if (response.ok) {
                    const demandes = await response.json();
                    addResult(`‚úÖ ${demandes.length} demande(s) trouv√©e(s)`, 'success');
                    demandes.forEach((demande, index) => {
                        addResult(`üìã Demande ${index + 1}: ${demande.raisonSociale} - ${demande.statut}`, 'info');
                    });
                } else {
                    const errorText = await response.text();
                    addResult(`‚ùå Erreur r√©cup√©ration: ${response.status} - ${errorText}`, 'error');
                }
            } catch (error) {
                addResult(`‚ùå Erreur r√©seau: ${error.message}`, 'error');
            }
        }

        async function testDirecteurLogin() {
            addResult('üîÑ Test connexion directeur...', 'info');

            try {
                const response = await fetch(`${API_BASE()}/auth/login`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ 
                        email: 'directeur@test.com', 
                        password: 'password123' 
                    })
                });

                if (response.ok) {
                    const data = await response.json();
                    const directeurToken = data.token;
                    
                    // Tester r√©cup√©ration des demandes pour directeur
                    const demandesResponse = await fetch(`${API_BASE()}/demandes-affiliation`, {
                        headers: { 'Authorization': `Bearer ${directeurToken}` }
                    });
                    
                    if (demandesResponse.ok) {
                        const demandes = await demandesResponse.json();
                        addResult(`‚úÖ Directeur connect√© - ${demandes.length} demande(s) √† traiter`, 'success');
                    } else {
                        addResult('‚ö†Ô∏è Directeur connect√© mais pas de demandes', 'info');
                    }
                } else {
                    addResult('‚ö†Ô∏è Directeur non disponible (normal si pas cr√©√©)', 'info');
                }
            } catch (error) {
                addResult(`‚ùå Erreur test directeur: ${error.message}`, 'error');
            }
        }

        // Auto-d√©marrage
        window.addEventListener('load', () => {
            addResult('üöÄ Interface de test initialis√©e', 'info');
            addResult('üí° 1. Connectez-vous comme employeur', 'info');
            addResult('üí° 2. Cr√©ez une demande d\'affiliation', 'info');
            addResult('üí° 3. V√©rifiez vos demandes', 'info');
        });
    </script>
</body>
</html>
